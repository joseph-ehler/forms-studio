# Factory Overlays - Batch Configuration Defaults
# 
# This file defines default settings per field type/archetype.
# The Generator merges these defaults when a spec omits a block.
# The Refiner can enforce/elevate legacy fields to these standards.
#
# Philosophy: DRY configuration at scale. Define once, apply everywhere.

# ============================================
# DEFAULT SETTINGS BY FIELD TYPE
# ============================================

defaults:
  # All text-like inputs (text, email, tel, url, etc.)
  text:
    ui:
      variant: default
      density: cozy
      size: md
      fullWidth: true
    validation:
      sync:
        required: false
    accessibility:
      label: true
      description: true
    performance:
      debounce: 0
      lazy: false
  
  # Email-specific defaults
  email:
    ui:
      variant: default
      density: cozy
      size: md
      iconLeft: mail
    validation:
      sync:
        required: true
        email: true
        minLength: 5
    telemetry:
      enabled: false  # Opt-in per field
      events: [focus, blur, validate]
      pii: hash
    security:
      sanitize: true
  
  # Number inputs
  number:
    ui:
      variant: default
      density: cozy
      size: md
    validation:
      sync:
        required: false
    accessibility:
      label: true
      description: true
  
  # Select/dropdown inputs
  select:
    ui:
      variant: default
      density: cozy
      size: md
      searchable: false
    validation:
      sync:
        required: false
    accessibility:
      label: true
      description: true
    performance:
      virtualizeAt: 50  # Virtualize lists with >50 options
  
  # Async search select (special archetype)
  'select.async':
    ui:
      behavior: async-search
      variant: default
      density: cozy
      size: md
      searchable: true
    validation:
      sync:
        required: false
    telemetry:
      enabled: true
      events: [search, select, blur]
      pii: hash
    performance:
      debounce: 300
      virtualizeAt: 50
  
  # Boolean inputs (checkbox, toggle, switch)
  boolean:
    ui:
      variant: default
      density: cozy
      size: md
    validation:
      sync:
        required: false
    accessibility:
      label: true
      ariaLabel: true
  
  # Date/Time pickers
  date:
    ui:
      variant: default
      density: cozy
      size: md
      format: 'YYYY-MM-DD'
    validation:
      sync:
        required: false
    accessibility:
      label: true
      description: true
  
  # File uploads
  file:
    ui:
      variant: default
      density: cozy
      size: md
      accept: '*'
      multiple: false
    validation:
      sync:
        required: false
    security:
      sanitize: true
      maxSize: 10485760  # 10MB
    performance:
      lazy: true

# ============================================
# UI VARIANT DEFINITIONS
# ============================================

variants:
  default:
    description: "Standard field styling with borders"
    classes: "ds-input w-full"
  
  quiet:
    description: "Minimal styling, borderless until focus"
    classes: "ds-input ds-input--quiet w-full"
  
  danger:
    description: "Error state styling"
    classes: "ds-input ds-input--danger w-full"
  
  success:
    description: "Success state styling"
    classes: "ds-input ds-input--success w-full"

# ============================================
# DENSITY PRESETS
# ============================================

density:
  compact:
    spacing: tight
    fontSize: sm
    minHeight: 36px
  
  cozy:
    spacing: normal
    fontSize: md
    minHeight: 48px
  
  comfortable:
    spacing: relaxed
    fontSize: lg
    minHeight: 56px

# ============================================
# ARCHETYPE PATTERNS
# ============================================

archetypes:
  # Fields that emit frequent value changes (search, tags, etc.)
  realtime:
    performance:
      debounce: 150
      lazy: false
    telemetry:
      enabled: true
      events: [change, blur]
  
  # Fields with external data (async validation, API calls)
  connected:
    validation:
      async:
        debounceMs: 300
    performance:
      idleValidation: true
    telemetry:
      enabled: true
      events: [focus, blur, validate]
  
  # Privacy-sensitive fields (password, SSN, credit card)
  sensitive:
    security:
      sanitize: true
      mask: true
    telemetry:
      enabled: true
      pii: hash  # Never send raw value
    accessibility:
      autocomplete: off

# ============================================
# REFINER ENFORCEMENT RULES
# ============================================

enforcement:
  # Which overlays should the Refiner actively enforce?
  enforceVariants: true
  enforceDensity: false  # Opt-in only
  enforceAccessibility: true
  enforceTelemetry: false  # Opt-in per field

# ============================================
# MIGRATION HINTS
# ============================================

migrations:
  v1_to_v2:
    # When migrating from v1.0 specs to v2.0
    steps:
      - "Add ui.variant from defaults"
      - "Add ui.density from defaults"
      - "Add accessibility.label: true"
      - "Run refiner to apply classes"
