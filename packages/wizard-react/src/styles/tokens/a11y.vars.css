/**
 * Accessibility Tokens - Runtime Control System
 * 
 * Single source of truth for accessibility preferences.
 * All DS components read from these tokens, which can be
 * modified at runtime without rebuilding.
 * 
 * Philosophy: User choice > System defaults
 */

@layer tokens {
  :root {
    /* ========================================
     * TYPOGRAPHY & READING
     * ======================================== */
    
    /* Font families (defaults - overridden by data attributes below) */
    --a11y-font-body: "Inter", -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    --a11y-font-headers: "Inter", -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    --a11y-font-mono: "SF Mono", "Fira Code", "Consolas", "Courier New", monospace;
    
    /* Scale multipliers */
    --a11y-font-size-scale: 1;              /* 1.0 = base, up to 1.5 for low vision */
    --a11y-line-height-multiplier: 1;       /* 1.0..1.5 for reading comfort */
    --a11y-letter-spacing-em: 0em;          /* 0..0.05em for dyslexia */
    --a11y-word-spacing-em: 0em;            /* 0..0.1em for dyslexia */
    
    /* Measure (reading width) */
    --a11y-measure-ch: 65ch;                /* 55â€“85ch readable range */
    
    
    /* ========================================
     * MOTION & ANIMATION
     * ======================================== */
    
    --a11y-reduced-motion-scale: 1;         /* 0 = disable animations, 1 = full */
    --a11y-transition-duration: 150ms;      /* Base transition speed */
    
    
    /* ========================================
     * FOCUS & KEYBOARD
     * ======================================== */
    
    --a11y-focus-ring-width: 2px;
    --a11y-focus-ring-offset: 2px;
    --a11y-focus-ring-color: var(--ds-color-border-focus);
    --a11y-focus-ring-style: solid;
    
    
    /* ========================================
     * TARGETS & TOUCH
     * ======================================== */
    
    --a11y-touch-min: 44px;                 /* WCAG 2.5.5 minimum */
    --a11y-touch-comfortable: 48px;         /* Recommended */
    --a11y-touch-relaxed: 56px;             /* Large */
    --a11y-touch-large: 64px;               /* Extra large */
    
    /* Density multiplier (affects spacing) */
    --a11y-density-multiplier: 1;           /* 0.9 (compact)..1.2 (spacious) */
    
    
    /* ========================================
     * COLOR & CONTRAST
     * ======================================== */
    
    /* Flags (0 = off, 1 = on) */
    --a11y-underline-links: 0;              /* Force underlines on all links */
    --a11y-high-contrast: 0;                /* Swap to high contrast palette */
    --a11y-colorblind-safe: 0;              /* Use colorblind-safe hues */
    
    
    /* ========================================
     * READING AIDS
     * ======================================== */
    
    --a11y-reading-ruler: 0;                /* Highlight current line/paragraph */
    --a11y-paragraph-focus: 0;              /* Dim non-focused paragraphs */
    --a11y-hyphenation: auto;               /* auto | none (off for dyslexia) */
    --a11y-text-align: left;                /* left | justify (force left for dyslexia) */
  }
  
  
  /* ========================================
   * FONT FAMILY PRESETS
   * ======================================== */
  
  /* ========================================
   * ROOT LEVEL APPLICATION
   * Apply a11y settings to <html> so EVERYTHING inherits
   * ======================================== */
  
  html {
    /* Apply base a11y settings to root */
    font-family: var(--a11y-font-body);
    font-size: calc(16px * var(--a11y-font-size-scale, 1));
    line-height: calc(1.5 * var(--a11y-line-height-multiplier, 1));
    letter-spacing: var(--a11y-letter-spacing-em, normal);
    word-spacing: var(--a11y-word-spacing-em, normal);
  }
  
  /* Dyslexia-friendly font (Lexend - web font + Comic Sans fallback) */
  :root[data-a11y-font="dyslexia"] {
    --a11y-font-body: "Lexend", "Comic Sans MS", "Comic Sans", "Marker Felt", fantasy, system-ui, sans-serif;
    --a11y-font-headers: "Lexend", "Comic Sans MS", "Comic Sans", "Marker Felt", fantasy, system-ui, sans-serif;
  }
  
  html[data-a11y-font="dyslexia"] {
    font-family: "Lexend", "Comic Sans MS", "Comic Sans", "Marker Felt", fantasy, system-ui, sans-serif;
  }
  
  /* Hyperlegible font (Atkinson) */
  :root[data-a11y-font="hyperlegible"] {
    --a11y-font-body: "Atkinson Hyperlegible", system-ui, sans-serif;
    --a11y-font-headers: "Atkinson Hyperlegible", system-ui, sans-serif;
  }
  
  html[data-a11y-font="hyperlegible"] {
    font-family: "Atkinson Hyperlegible", system-ui, sans-serif;
  }
  
  
  /* ========================================
   * MOTION SAFETY
   * ======================================== */
  
  /* Respect system preference */
  @media (prefers-reduced-motion: reduce) {
    :root {
      --a11y-reduced-motion-scale: 0;
      --a11y-transition-duration: 0ms;
    }
  }
  
  /* Runtime override */
  :root[data-a11y-motion="off"] {
    --a11y-reduced-motion-scale: 0;
    --a11y-transition-duration: 0ms;
  }
  
  :root[data-a11y-motion="off"] * {
    transition: none !important;
    animation: none !important;
  }
  
  
  /* ========================================
   * HIGH CONTRAST MODE
   * ======================================== */
  
  :root[style*="--a11y-high-contrast: 1"] {
    /* Text colors */
    --ds-color-text-primary: #ffffff;
    --ds-color-text-secondary: #e0e0e0;
    --ds-color-text-muted: #bdbdbd;
    --ds-color-text-inverted: #000000;
    
    /* Surface colors */
    --ds-color-surface-base: #000000;
    --ds-color-surface-subtle: #1a1a1a;
    --ds-color-surface-raised: #2a2a2a;
    
    /* Border colors */
    --ds-color-border-subtle: #757575;
    --ds-color-border-strong: #9e9e9e;
    
    /* Interactive - vivid for high contrast */
    --ds-color-primary-bg: #ff2a6d;
    --ds-color-primary-text: #000000;
    --ds-color-primary-bg-hover: #ff4080;
    
    /* State colors - high contrast */
    --ds-color-state-success: #00ff00;
    --ds-color-state-danger: #ff0000;
    --ds-color-state-warning: #ffff00;
    --ds-color-state-info: #00ffff;
    
    /* Links */
    --ds-color-text-link: #00d4ff;
    --ds-color-text-link-hover: #66e5ff;
  }
  
  
  /* ========================================
   * COLORBLIND-SAFE MODE
   * ======================================== */
  
  :root[style*="--a11y-colorblind-safe: 1"] {
    /* State colors - deuteranopia-safe */
    --ds-color-state-success: #2aa745;  /* Green distinguishable from red */
    --ds-color-state-danger: #d12f2f;   /* Red with luminance contrast */
    --ds-color-state-warning: #cc8c00;  /* Orange-brown */
    --ds-color-state-info: #0a6cff;     /* Blue */
    
    /* Links - blue with good luminance */
    --ds-color-text-link: #0a6cff;
    --ds-color-text-link-hover: #003d99;
  }
  
  
  /* ========================================
   * READING AIDS
   * ======================================== */
  
  /* Reading ruler (highlight current line) */
  :root[data-a11y-reading-ruler="on"] .ds-prose p {
    position: relative;
  }
  
  :root[data-a11y-reading-ruler="on"] .ds-prose p:is(:hover, :focus-within)::before {
    content: "";
    position: absolute;
    inset-inline: -0.5rem;
    inset-block: -0.15em;
    background: color-mix(in srgb, var(--ds-color-text-primary) 8%, transparent);
    border-radius: 0.25rem;
    pointer-events: none;
    z-index: -1;
  }
  
  /* Paragraph focus (dim unfocused) */
  :root[data-a11y-paragraph-focus="on"] .ds-prose p {
    opacity: 0.5;
    transition: opacity 200ms ease;
  }
  
  :root[data-a11y-paragraph-focus="on"] .ds-prose p:is(:hover, :focus-within) {
    opacity: 1;
  }
}
