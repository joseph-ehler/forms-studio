<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Nested Sheets Demo - Design System</title>
  <style>
    * {
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
      margin: 0;
    }

    .demo-container {
      width: 100%;
      max-width: 1600px;
      min-height: 900px;
      background: white;
      border-radius: 20px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      display: flex;
      overflow: hidden;
    }

    /* Phone Mockup */
    .phone-mockup {
      width: 400px;
      background: #1f2937;
      padding: 20px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
    }

    .phone-notch {
      width: 140px;
      height: 30px;
      background: black;
      border-radius: 0 0 20px 20px;
      position: absolute;
      top: 0;
      left: 50%;
      transform: translateX(-50%);
      z-index: 1000;
    }

    .phone-screen {
      width: 100%;
      height: 720px;
      background: #f9fafb;
      border-radius: 30px;
      position: relative;
      overflow: hidden;
      box-shadow: 0 0 0 8px #1f2937, 0 0 0 10px #374151;
    }

    /* Main Content */
    .main-content {
      flex: 1;
      display: flex;
      flex-direction: column;
      padding: 40px;
      background: linear-gradient(135deg, #667eea15 0%, #764ba215 100%);
    }

    .main-content h2 {
      margin: 0 0 20px 0;
      color: #1f2937;
      font-size: 24px;
    }

    .button-group {
      display: flex;
      flex-direction: column;
      gap: 12px;
      margin-top: 20px;
    }

    button {
      padding: 16px 24px;
      border: 2px solid #3b82f6;
      background: white;
      border-radius: 12px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      color: #3b82f6;
    }

    button:hover {
      background: #3b82f6;
      color: white;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
    }

    button:active {
      transform: translateY(0);
    }

    button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }

    /* Status Indicator */
    .status-indicator {
      padding: 12px 16px;
      background: #f3f4f6;
      border-radius: 8px;
      font-size: 14px;
      margin-top: 20px;
    }

    /* Sheet Styles */
    .ds-sheet {
      display: flex;
      flex-direction: column;
      background: white;
      overflow: hidden;
    }

    .ds-sheet-header {
      padding: 20px;
      border-bottom: 1px solid #e5e7eb;
      flex-shrink: 0;
      background: white;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .ds-sheet-header h3 {
      margin: 0;
      font-size: 20px;
      font-weight: 600;
      color: #1f2937;
    }

    .close-btn {
      width: 32px;
      height: 32px;
      border: none;
      background: #f3f4f6;
      border-radius: 50%;
      font-size: 18px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s;
      padding: 0;
      color: #6b7280;
    }

    .close-btn:hover {
      background: #e5e7eb;
      color: #1f2937;
    }

    .ds-sheet-content {
      flex: 1;
      overflow-y: auto;
      min-height: 0;
      position: relative;
    }

    .ds-sheet-content-inner {
      padding: 20px;
    }

    .ds-sheet-footer {
      padding: 16px 20px;
      border-top: 1px solid #e5e7eb;
      display: flex;
      gap: 10px;
      flex-shrink: 0;
      background: white;
    }

    .ds-sheet-footer button {
      flex: 1;
      padding: 12px;
      border-radius: 8px;
      font-size: 14px;
    }

    /* Sheet Dialog */
    .ds-sheet-dialog {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      background: white;
      border-radius: 16px 16px 0 0;
      display: flex;
      flex-direction: column;
      height: 60%;
      transform: translateY(100%);
      transition: transform 350ms cubic-bezier(0.32, 0.72, 0, 1),
                  box-shadow 180ms ease;
      will-change: transform;
    }

    .ds-sheet-dialog.ds-visible {
      transform: translateY(0);
    }

    /* Backdrop */
    .ds-sheet-backdrop {
      position: absolute;
      inset: 0;
      background: rgba(0, 0, 0, 0.45);
      opacity: 0;
      pointer-events: none;
      transition: opacity 350ms ease, background 180ms ease;
    }

    .ds-sheet-backdrop.ds-visible {
      opacity: 1;
      pointer-events: auto;
    }

    /* Nested Sheet Styles */
    .ds-sheet--underlay[data-sheet-depth="0"] {
      transform: translateY(-16px) scale(0.98); /* Move UP to peek above nested sheet */
      box-shadow: 0 4px 16px rgba(0, 0, 0, 0.15);
      transition: transform 180ms cubic-bezier(0.4, 0, 0.2, 1),
                  box-shadow 180ms cubic-bezier(0.4, 0, 0.2, 1);
    }

    @media (prefers-reduced-motion: reduce) {
      .ds-sheet--underlay[data-sheet-depth="0"] {
        transform: translateY(-16px); /* Move UP, remove scale */
      }
    }

    /* Backdrop intensity by depth */
    .ds-sheet-backdrop[data-depth="0"] {
      background: rgba(0, 0, 0, 0.45);
    }

    .ds-sheet-backdrop[data-depth="1"] {
      background: rgba(0, 0, 0, 0.55);
    }

    /* Shadow elevation by depth */
    .ds-sheet-dialog[data-sheet-depth="0"] {
      box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.2);
      z-index: 10;
    }

    .ds-sheet-dialog[data-sheet-depth="1"] {
      box-shadow: 0 -8px 24px rgba(0, 0, 0, 0.25);
      z-index: 20;
    }

    .ds-sheet-backdrop[data-depth="0"] { z-index: 9; }
    .ds-sheet-backdrop[data-depth="1"] { z-index: 19; }

    /* Inert state */
    .ds-inert {
      pointer-events: none;
      user-select: none;
    }

    /* Controls Panel */
    .controls-panel {
      flex: 1;
      padding: 40px;
      overflow-y: auto;
    }

    .controls-panel h1 {
      margin: 0 0 8px 0;
      color: #1f2937;
      font-size: 32px;
    }

    .controls-panel > p {
      margin: 0 0 32px 0;
      color: #6b7280;
      font-size: 18px;
    }

    .info-box {
      background: #f9fafb;
      padding: 20px;
      border-radius: 12px;
      margin-bottom: 20px;
      border-left: 4px solid #3b82f6;
    }

    .info-box h4 {
      margin: 0 0 12px 0;
      color: #1f2937;
      font-size: 16px;
      font-weight: 600;
    }

    .info-box ul {
      margin: 0;
      padding-left: 20px;
      color: #6b7280;
      line-height: 1.6;
    }

    .info-box li {
      margin-bottom: 4px;
    }

    .info-box code {
      background: #e5e7eb;
      padding: 2px 6px;
      border-radius: 4px;
      font-size: 13px;
      color: #1f2937;
    }

    .policy-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 16px;
      margin-top: 20px;
    }

    .policy-card {
      padding: 16px;
      border-radius: 8px;
      border: 2px solid;
    }

    .policy-card.allowed {
      border-color: #10b981;
      background: #ecfdf5;
    }

    .policy-card.blocked {
      border-color: #ef4444;
      background: #fef2f2;
    }

    .policy-card h5 {
      margin: 0 0 8px 0;
      font-size: 14px;
      font-weight: 600;
    }

    .policy-card.allowed h5 { color: #059669; }
    .policy-card.blocked h5 { color: #dc2626; }

    .policy-card p {
      margin: 0;
      font-size: 13px;
      color: #6b7280;
    }

    .depth-indicator {
      padding: 16px;
      background: #eff6ff;
      border-radius: 8px;
      margin-top: 20px;
      text-align: center;
    }

    .depth-indicator .depth-label {
      font-size: 14px;
      color: #6b7280;
      margin-bottom: 8px;
    }

    .depth-indicator .depth-value {
      font-size: 36px;
      font-weight: 700;
      color: #3b82f6;
    }

    .depth-indicator .depth-max {
      font-size: 14px;
      color: #9ca3af;
      margin-top: 4px;
    }

    /* Item list for demo content */
    .item-list {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .item {
      padding: 12px;
      background: #f9fafb;
      border-radius: 8px;
      border: 2px solid transparent;
      cursor: pointer;
      transition: all 0.2s;
    }

    .item:hover {
      border-color: #3b82f6;
      background: #eff6ff;
    }

    .item.selected {
      border-color: #3b82f6;
      background: #eff6ff;
    }

    @media (max-width: 1200px) {
      .demo-container {
        flex-direction: column;
      }
      
      .phone-mockup {
        width: 100%;
        padding: 20px 0;
      }
    }
  </style>
</head>
<body>
  <div class="demo-container">
    <!-- Phone Mockup -->
    <div class="phone-mockup">
      <div class="phone-screen" id="phoneScreen">
        <div class="phone-notch"></div>

        <!-- Main Content -->
        <div class="main-content" id="mainContent">
          <h2>Task Manager</h2>
          
          <div class="button-group">
            <button id="openDialog1">Open Task List (Level 1)</button>
            <button id="openDialog2" disabled>Open Subtask (Level 2)</button>
            <button id="openDialog3" disabled>Try Level 3 (Blocked)</button>
          </div>

          <div class="status-indicator">
            <strong>Current Stack:</strong> <span id="stackStatus">Empty</span>
          </div>
        </div>

        <!-- Backdrop Level 0 -->
        <div class="ds-sheet-backdrop" data-depth="0" id="backdrop1"></div>

        <!-- Sheet Dialog Level 0 -->
        <div class="ds-sheet-dialog ds-sheet" data-sheet-depth="0" id="dialog1" role="dialog" aria-label="Select Task">
          <div class="ds-sheet-header">
            <h3>Select Task</h3>
            <button class="close-btn" id="closeDialog1" aria-label="Close">✕</button>
          </div>

          <div class="ds-sheet-content">
            <div class="ds-sheet-content-inner">
              <div class="item-list">
                <div class="item" data-task="design">
                  <strong>Design System Updates</strong>
                  <div style="font-size: 13px; color: #6b7280; margin-top: 4px;">
                    Click to open subtasks →
                  </div>
                </div>
                <div class="item" data-task="docs">
                  <strong>Documentation</strong>
                  <div style="font-size: 13px; color: #6b7280; margin-top: 4px;">
                    Click to open subtasks →
                  </div>
                </div>
                <div class="item" data-task="testing">
                  <strong>Testing Suite</strong>
                  <div style="font-size: 13px; color: #6b7280; margin-top: 4px;">
                    Click to open subtasks →
                  </div>
                </div>
              </div>

              <div style="margin-top: 20px; padding: 16px; background: #eff6ff; border-radius: 8px; font-size: 14px; color: #1e40af;">
                💡 <strong>Try it:</strong> Click any task to open a subtask dialog (nested sheet)
              </div>
            </div>
          </div>

          <div class="ds-sheet-footer">
            <button id="cancelDialog1">Cancel</button>
            <button id="doneDialog1" style="background: #3b82f6; color: white; border-color: #3b82f6;">Done</button>
          </div>
        </div>

        <!-- Backdrop Level 1 -->
        <div class="ds-sheet-backdrop" data-depth="1" id="backdrop2"></div>

        <!-- Sheet Dialog Level 1 (Nested) -->
        <div class="ds-sheet-dialog ds-sheet" data-sheet-depth="1" id="dialog2" role="dialog" aria-label="Select Subtask">
          <div class="ds-sheet-header">
            <h3>Subtasks</h3>
            <button class="close-btn" id="closeDialog2" aria-label="Close">✕</button>
          </div>

          <div class="ds-sheet-content">
            <div class="ds-sheet-content-inner">
              <div class="item-list">
                <div class="item">
                  <strong>Update Button Component</strong>
                  <div style="font-size: 13px; color: #6b7280; margin-top: 4px;">
                    ✅ Ready to start
                  </div>
                </div>
                <div class="item">
                  <strong>Add Animation Tokens</strong>
                  <div style="font-size: 13px; color: #6b7280; margin-top: 4px;">
                    🎨 Design phase
                  </div>
                </div>
                <div class="item">
                  <strong>Write Storybook Examples</strong>
                  <div style="font-size: 13px; color: #6b7280; margin-top: 4px;">
                    📝 Documentation
                  </div>
                </div>
              </div>

              <div style="margin-top: 20px; padding: 16px; background: #fef3c7; border-radius: 8px; font-size: 14px; color: #92400e;">
                ⚠️ <strong>Notice:</strong> The first dialog is now inert (darkened, can't interact)
              </div>
            </div>
          </div>

          <div class="ds-sheet-footer">
            <button id="cancelDialog2">Cancel</button>
            <button id="selectSubtask" style="background: #3b82f6; color: white; border-color: #3b82f6;">Select</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Controls Panel -->
    <div class="controls-panel">
      <h1>Nested Sheets Demo</h1>
      <p>Card stack pattern with depth limits</p>

      <!-- Current Depth -->
      <div class="depth-indicator">
        <div class="depth-label">Current Stack Depth</div>
        <div class="depth-value" id="currentDepth">0</div>
        <div class="depth-max">Max: 2</div>
      </div>

      <!-- Policy Matrix -->
      <div class="info-box">
        <h4>🧭 Nesting Policy</h4>
        <div class="policy-grid">
          <div class="policy-card allowed">
            <h5>✅ Dialog → Dialog</h5>
            <p>Subtask modals (depth ≤ 2)</p>
          </div>
          <div class="policy-card allowed">
            <h5>✅ Panel → Dialog</h5>
            <p>Modal over panel</p>
          </div>
          <div class="policy-card blocked">
            <h5>❌ Dialog → Panel</h5>
            <p>Don't de-modalize</p>
          </div>
          <div class="policy-card blocked">
            <h5>❌ Depth > 2</h5>
            <p>Use full-screen route</p>
          </div>
        </div>
      </div>

      <!-- Card Stack Effects -->
      <div class="info-box">
        <h4>✨ Card Stack Effects</h4>
        <ul>
          <li><strong>Underlying sheet:</strong> Translates down 16px (~1rem), scales to 0.98</li>
          <li><strong>Context peek:</strong> Top edge of underlying sheet remains visible</li>
          <li><strong>Backdrop:</strong> Darkens +10-15% per level</li>
          <li><strong>Shadow:</strong> Elevation increases per depth</li>
          <li><strong>Z-index:</strong> Each level adds 10 (10, 20, 30...)</li>
        </ul>
      </div>

      <!-- Interaction -->
      <div class="info-box">
        <h4>🎮 Interactions</h4>
        <ul>
          <li><strong>Open Level 1:</strong> Click "Open Task List"</li>
          <li><strong>Open Level 2:</strong> Click any task in Level 1</li>
          <li><strong>Try Level 3:</strong> Blocked with console error</li>
          <li><strong>Close topmost:</strong> Click X or press Esc</li>
          <li><strong>Close all:</strong> Press Esc twice</li>
        </ul>
      </div>

      <!-- A11y -->
      <div class="info-box">
        <h4>♿ Accessibility</h4>
        <ul>
          <li><strong>Focus trap:</strong> Only on topmost dialog</li>
          <li><strong>Underlying:</strong> aria-hidden + inert</li>
          <li><strong>Esc key:</strong> Closes topmost, then next</li>
          <li><strong>Unique labels:</strong> Each dialog requires distinct aria-label</li>
        </ul>
      </div>

      <!-- Testing -->
      <div class="info-box">
        <h4>🧪 What to Test</h4>
        <ul>
          <li>Open Level 1 → underlying content darkens & becomes inert</li>
          <li>Open Level 2 → Level 1 translates down & scales</li>
          <li>Try Level 3 → Check console for error</li>
          <li>Press Esc → Closes topmost, focus returns</li>
          <li>Reduced motion → Scale effect disabled</li>
        </ul>
      </div>
    </div>
  </div>

  <script>
    // Elements
    const mainContent = document.getElementById('mainContent');
    const dialog1 = document.getElementById('dialog1');
    const dialog2 = document.getElementById('dialog2');
    const backdrop1 = document.getElementById('backdrop1');
    const backdrop2 = document.getElementById('backdrop2');
    const stackStatus = document.getElementById('stackStatus');
    const currentDepth = document.getElementById('currentDepth');
    
    const openDialog1Btn = document.getElementById('openDialog1');
    const openDialog2Btn = document.getElementById('openDialog2');
    const openDialog3Btn = document.getElementById('openDialog3');
    const closeDialog1Btn = document.getElementById('closeDialog1');
    const closeDialog2Btn = document.getElementById('closeDialog2');
    const cancelDialog1Btn = document.getElementById('cancelDialog1');
    const cancelDialog2Btn = document.getElementById('cancelDialog2');
    const doneDialog1Btn = document.getElementById('doneDialog1');
    const selectSubtaskBtn = document.getElementById('selectSubtask');

    let depth = 0;

    // Update UI
    function updateUI() {
      currentDepth.textContent = depth;
      
      if (depth === 0) {
        stackStatus.textContent = 'Empty';
        openDialog1Btn.disabled = false;
        openDialog2Btn.disabled = true;
        openDialog3Btn.disabled = true;
      } else if (depth === 1) {
        stackStatus.textContent = 'Level 1 (Task List)';
        openDialog1Btn.disabled = true;
        openDialog2Btn.disabled = false;
        openDialog3Btn.disabled = false;
      } else if (depth === 2) {
        stackStatus.textContent = 'Level 1 → Level 2 (Subtasks)';
        openDialog1Btn.disabled = true;
        openDialog2Btn.disabled = true;
        openDialog3Btn.disabled = false;
      }
    }

    // Open Dialog 1
    function openDialog1() {
      dialog1.classList.add('ds-visible');
      backdrop1.classList.add('ds-visible');
      mainContent.classList.add('ds-inert');
      depth = 1;
      updateUI();
    }

    // Open Dialog 2 (nested)
    function openDialog2() {
      // Apply underlay class to Dialog 1
      dialog1.classList.add('ds-sheet--underlay');
      dialog1.classList.add('ds-inert');
      
      // Open Dialog 2
      dialog2.classList.add('ds-visible');
      backdrop2.classList.add('ds-visible');
      
      depth = 2;
      updateUI();
    }

    // Close Dialog 2
    function closeDialog2() {
      dialog2.classList.remove('ds-visible');
      backdrop2.classList.remove('ds-visible');
      
      // Remove underlay from Dialog 1
      setTimeout(() => {
        dialog1.classList.remove('ds-sheet--underlay');
        dialog1.classList.remove('ds-inert');
      }, 180);
      
      depth = 1;
      updateUI();
    }

    // Close Dialog 1
    function closeDialog1() {
      dialog1.classList.remove('ds-visible');
      backdrop1.classList.remove('ds-visible');
      mainContent.classList.remove('ds-inert');
      
      depth = 0;
      updateUI();
    }

    // Try to open Level 3 (blocked)
    function tryOpenDialog3() {
      console.error(
        '[SheetPolicy] Maximum stack depth (2) exceeded. ' +
        'Use full-screen route for deeper flows. Current depth: ' + depth
      );
      
      alert(
        '❌ Cannot open Level 3\n\n' +
        'Maximum stack depth is 2.\n' +
        'Use a full-screen route for deeper flows.\n\n' +
        'Check the console for the error message.'
      );
    }

    // Event listeners
    openDialog1Btn.addEventListener('click', openDialog1);
    openDialog2Btn.addEventListener('click', openDialog2);
    openDialog3Btn.addEventListener('click', tryOpenDialog3);
    
    closeDialog1Btn.addEventListener('click', closeDialog1);
    closeDialog2Btn.addEventListener('click', closeDialog2);
    
    cancelDialog1Btn.addEventListener('click', closeDialog1);
    cancelDialog2Btn.addEventListener('click', closeDialog2);
    
    doneDialog1Btn.addEventListener('click', closeDialog1);
    selectSubtaskBtn.addEventListener('click', closeDialog2);

    // Task items open Dialog 2
    document.querySelectorAll('.item[data-task]').forEach(item => {
      item.addEventListener('click', () => {
        if (depth === 1) {
          openDialog2();
        }
      });
    });

    // Esc key closes topmost
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') {
        if (depth === 2) {
          closeDialog2();
        } else if (depth === 1) {
          closeDialog1();
        }
      }
    });

    // Backdrop clicks (modal, so does nothing)
    backdrop1.addEventListener('click', () => {
      // Intentionally empty - modal dialogs don't close on backdrop click
    });
    
    backdrop2.addEventListener('click', () => {
      // Intentionally empty
    });

    // Initialize
    updateUI();
  </script>
</body>
</html>
