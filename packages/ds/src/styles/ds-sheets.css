/**
 * DS Sheets - Canonical Sheet Layout Patterns
 * 
 * This stylesheet codifies all sheet layout rules from SHEET_LAYOUT_RULES.md
 * Import once, get correct behavior everywhere.
 * 
 * Rules enforced:
 * 1. Desktop docked = side-by-side (flexbox)
 * 2. Closed = display: none (no layout artifacts)
 * 3. Mobile sheet = overlay (absolute + transform)
 * 4. Fixed header/footer, scrollable content
 * 4a. Sticky search/filters
 * 5. Smooth animations (350ms spring easing)
 * 6. Resize keeps panel open
 * 7. Layout properties instant at breakpoints
 * 8. Keyboard adapts sheet height
 */

/* ========================================
   BASE SHEET STRUCTURE
   ======================================== */

/**
 * Sheet container - flexbox column layout
 * Required structure:
 * - .ds-sheet-header (fixed)
 * - .ds-sheet-content (scrollable)
 * - .ds-sheet-footer (fixed)
 */
.ds-sheet {
  display: flex;
  flex-direction: column;
  background: white;
  overflow: hidden;
}

/* ========================================
   FIXED HEADER & FOOTER
   ======================================== */

.ds-sheet-header,
.ds-sheet-footer {
  flex-shrink: 0; /* Never shrink */
  background: white; /* Opaque for scroll underneath */
}

/* ========================================
   SCROLLABLE CONTENT
   ======================================== */

.ds-sheet-content {
  flex: 1; /* Take remaining space */
  overflow-y: auto;
  min-height: 0; /* Enable flex scrolling */
  overscroll-behavior: contain; /* Prevent scroll chaining */
  position: relative; /* For sticky children */
}

/* Inner content padding container */
.ds-sheet-content-inner {
  padding: 20px;
}

/* ========================================
   STICKY ACTIONS (Search, Filters, Tabs)
   ======================================== */

.ds-sheet-sticky-actions {
  position: sticky;
  top: 0;
  background: white;
  padding: 16px 20px;
  border-bottom: 1px solid #e5e7eb;
  z-index: 1;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.02);
}

/* ========================================
   DESKTOP: DOCKED PANEL
   Side-by-side layout, never overlay
   ======================================== */

.ds-panel-docked {
  width: 0;
  flex-shrink: 0;
  background: white;
  border-left: 1px solid #e5e7eb;
  display: none; /* Hidden when closed - prevents layout artifacts */
  flex-direction: column;
  overflow: hidden;
  transition: width 300ms ease;
}

.ds-panel-docked.ds-visible {
  display: flex; /* Show when open */
  width: min(420px, 35vw);
  animation: ds-slideInRight 300ms ease;
}

@keyframes ds-slideInRight {
  from {
    width: 0;
    opacity: 0;
  }
  to {
    width: min(420px, 35vw);
    opacity: 1;
  }
}

/* ========================================
   MOBILE: SHEET OVERLAY
   Bottom sheet with transform animation
   ======================================== */

@media (max-width: 768px) {
  .ds-panel-docked {
    /* Switch to absolute positioning for overlay */
    position: absolute;
    right: 0;
    bottom: 0;
    top: auto;
    left: 0;
    width: 100%;
    height: 70%;
    border-left: none;
    border-radius: 16px 16px 0 0;
    box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.2);
    z-index: 700; /* var(--ds-z-lane-panel) */
    display: block; /* Override desktop display */
    transform: translateY(100%);
    transition: transform 350ms cubic-bezier(0.32, 0.72, 0, 1);
  }

  .ds-panel-docked.ds-visible {
    width: 100%;
    transform: translateY(0);
    animation: none; /* No width animation on mobile */
  }
}

/* ========================================
   SHEET DIALOG (Modal)
   Always overlay, desktop and mobile
   ======================================== */

.ds-sheet-dialog {
  position: absolute;
  bottom: 0;
  left: 0;
  right: 0;
  background: white;
  border-radius: 16px 16px 0 0;
  box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.2);
  display: flex;
  flex-direction: column;
  z-index: 10;
  height: 70%;
  transform: translateY(100%);
  transition: transform 350ms cubic-bezier(0.32, 0.72, 0, 1);
  will-change: transform; /* GPU acceleration */
}

.ds-sheet-dialog.ds-visible {
  transform: translateY(0);
}

/* ========================================
   BACKDROP
   ======================================== */

.ds-sheet-backdrop {
  position: absolute;
  inset: 0;
  background: rgba(0, 0, 0, 0.5);
  opacity: 0;
  pointer-events: none;
  z-index: 9;
  transition: opacity 350ms ease;
}

.ds-sheet-backdrop.ds-visible {
  opacity: 1;
  pointer-events: auto;
}

/* ========================================
   KEYBOARD HANDLING (Mobile)
   Sheet adapts when virtual keyboard opens
   ======================================== */

.ds-keyboard-open .ds-sheet-dialog {
  bottom: 300px; /* Sits above keyboard (adjust based on keyboard height) */
  height: calc(70% - 150px); /* Shrinks to avoid keyboard */
  transition: all 300ms cubic-bezier(0.4, 0, 0.2, 1);
}

/* Mock keyboard for demos */
.ds-mock-keyboard {
  position: absolute;
  bottom: 0;
  left: 0;
  right: 0;
  height: 0;
  background: linear-gradient(to bottom, #d1d5db 0%, #9ca3af 100%);
  z-index: 999;
  transition: height 300ms cubic-bezier(0.4, 0, 0.2, 1);
  display: flex;
  align-items: center;
  justify-content: center;
  color: #374151;
  font-weight: 600;
  font-size: 14px;
  box-shadow: 0 -4px 12px rgba(0, 0, 0, 0.2);
  border-radius: 0;
}

.ds-mock-keyboard.ds-visible {
  height: 300px;
}

/* ========================================
   RESPONSIVE BREAKPOINTS
   Layout properties change instantly (0ms)
   Only position/transform animates
   ======================================== */

@media (max-width: 768px) {
  .ds-panel-docked {
    /* Instant layout changes */
    transition: transform 350ms cubic-bezier(0.32, 0.72, 0, 1),
                width 0ms,
                border-radius 0ms;
  }
}

/* ========================================
   ACCESSIBILITY
   ======================================== */

.ds-sheet[aria-hidden="true"] {
  display: none;
}

/* Modal dialogs handled by backdrop z-index stacking */

/* ========================================
   UTILITY CLASSES
   ======================================== */

/* Inert content (when sheet is modal) */
.ds-inert {
  pointer-events: none;
  user-select: none;
  opacity: 0.6;
}

/* Hidden state (no layout artifacts) */
.ds-hidden {
  display: none !important;
}

/* Visible state - used with display: none base state */
/* Applied/removed via JavaScript to toggle visibility */

/* ========================================
   NESTED SHEETS (Card Stack Pattern)
   ======================================== */

/**
 * Nested sheet tokens
 * Policy: Max depth 2, topmost must be dialog
 * Stack translate shows ~1rem of underlying sheet for context
 */
:root {
  --ds-sheet-stack-translate: 16px; /* Show underlying sheet for depth context */
  --ds-sheet-underlay-scale: 0.98;
  --ds-sheet-parallax-factor: 0.12;
  
  /* Backdrop intensity by depth */
  --ds-backdrop-depth-0: rgba(0, 0, 0, 0.45);
  --ds-backdrop-depth-1: rgba(0, 0, 0, 0.55);
  --ds-backdrop-depth-2: rgba(0, 0, 0, 0.65);
  
  /* Elevation by depth */
  --ds-shadow-depth-0: 0 4px 16px rgba(0, 0, 0, 0.15);
  --ds-shadow-depth-1: 0 8px 24px rgba(0, 0, 0, 0.2);
  --ds-shadow-depth-2: 0 12px 32px rgba(0, 0, 0, 0.25);
}

/**
 * Underlying sheet treatment (when another opens on top)
 * Creates "card stack" visual effect
 * Moves UP so top edge peeks above the nested sheet
 */
.ds-sheet--underlay[data-sheet-depth="0"] {
  transform: translateY(-16px) scale(0.98); /* Move UP to peek above */
  box-shadow: var(--ds-shadow-depth-0);
  transition: transform 180ms cubic-bezier(0.4, 0, 0.2, 1),
              box-shadow 180ms cubic-bezier(0.4, 0, 0.2, 1);
}

/* Reduced motion: keep translate, remove scale */
@media (prefers-reduced-motion: reduce) {
  .ds-sheet--underlay[data-sheet-depth="0"] {
    transform: translateY(-16px); /* Move UP, remove scale */
  }
}

/**
 * Backdrop intensity increases per depth
 */
.ds-sheet-backdrop[data-depth="0"] {
  background: var(--ds-backdrop-depth-0);
}

.ds-sheet-backdrop[data-depth="1"] {
  background: var(--ds-backdrop-depth-1);
}

.ds-sheet-backdrop[data-depth="2"] {
  background: var(--ds-backdrop-depth-2);
}

/**
 * Shadow elevation increases per depth
 */
.ds-sheet-dialog[data-sheet-depth="0"] {
  box-shadow: var(--ds-shadow-depth-0);
}

.ds-sheet-dialog[data-sheet-depth="1"] {
  box-shadow: var(--ds-shadow-depth-1);
}

.ds-sheet-dialog[data-sheet-depth="2"] {
  box-shadow: var(--ds-shadow-depth-2);
}

/**
 * Z-index by depth
 * Base: 10 (dialog), 9 (backdrop)
 * Each depth adds 10
 */
.ds-sheet-dialog[data-sheet-depth="0"] { z-index: 10; }
.ds-sheet-backdrop[data-depth="0"] { z-index: 9; }

.ds-sheet-dialog[data-sheet-depth="1"] { z-index: 20; }
.ds-sheet-backdrop[data-depth="1"] { z-index: 19; }

.ds-sheet-dialog[data-sheet-depth="2"] { z-index: 30; }
.ds-sheet-backdrop[data-depth="2"] { z-index: 29; }

/* ========================================
   PRINT
   ======================================== */

@media print {
  .ds-sheet-dialog,
  .ds-panel-docked,
  .ds-sheet-backdrop {
    display: none !important;
  }
}

/* ========================================
   REDUCED MOTION
   ======================================== */

@media (prefers-reduced-motion: reduce) {
  .ds-sheet-dialog,
  .ds-panel-docked,
  .ds-sheet-backdrop,
  .ds-mock-keyboard {
    transition-duration: 0.01ms !important;
    animation-duration: 0.01ms !important;
  }
}
